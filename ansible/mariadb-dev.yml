---
- name: Set up MariaDB 10.5 for development
  hosts: localhost
  become: true
  tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: latest
        update_cache: true

    - name: Upgrade packages
      apt:
        upgrade: safe

    - name: Install required system packages
      apt:
        pkg:
          - build-essential
          - default-libmysqlclient-dev
          - libmariadb-dev
          - mariadb-server
          - pkg-config
          - python3-dev
          - python3-pip

        state: latest
        update_cache: true

    - name: Create a new database with name "mediaexplorer"
      become_user: postgres
      community.postgresql.postgresql_db:
        name: mediaexplorer
        comment: Media Explorer development database

    - name: Connect to database, create mediaexplorer user
      become_user: postgres
      community.postgresql.postgresql_user:
        db: mediaexplorer
        name: mediaexplorer
        password: password
        configuration:
          client_encoding: utf8
          default_transaction_isolation: read committed
          timezone: UTC

    - name: GRANT ALL PRIVILEGES ON DATABASE mediaexplorer TO mediaexplorer
      become_user: postgres
      community.postgresql.postgresql_privs:
        db: mediaexplorer
        privs: ALL
        type: database
        obj: mediaexplorer
        role: mediaexplorer

    - name: ALTER DATABASE mediaexplorer OWNER TO mediaexplorer
      become_user: postgres
      community.postgresql.postgresql_db:
        name: mediaexplorer
        owner: mediaexplorer
